From 2f035f1ecfb2b00ad414a5082112880c54e4ac17 Mon Sep 17 00:00:00 2001
From: "L. E. Segovia" <amy@amyspark.me>
Date: Thu, 17 Nov 2022 11:56:02 -0300
Subject: [PATCH 5/9] toolutil: Fix MASM generation for x86-64 and ARM64

---
 source/tools/toolutil/pkg_genc.cpp | 12 ++++++++++++
 1 file changed, 12 insertions(+)

diff --git a/source/tools/toolutil/pkg_genc.cpp b/source/tools/toolutil/pkg_genc.cpp
index d9b2265..7962f8c 100644
--- a/source/tools/toolutil/pkg_genc.cpp
+++ b/source/tools/toolutil/pkg_genc.cpp
@@ -228,6 +228,17 @@ static const struct AssemblyType {
     },
 /* align 16 bytes */
 /*  http://msdn.microsoft.com/en-us/library/dwa9fwef.aspx */
+#if defined(_WIN64)
+    { "masm",
+      "\tTITLE %s\n"
+      "; generated by genccode\n"
+      "\tPUBLIC _%s\n"
+      "ICUDATA_%s\tSEGMENT READONLY 'DATA'\n"
+      "\tALIGN 16\n"
+      "_%s\tLABEL DWORD\n",
+      "\tDWORD ","\nICUDATA_%s\tENDS\n\tEND\n",HEX_0H
+    }
+#else
     { "masm",
       "\tTITLE %s\n"
       "; generated by genccode\n"
@@ -239,6 +250,7 @@ static const struct AssemblyType {
       "_%s\tLABEL DWORD\n",
       "\tDWORD ","\nICUDATA_%s\tENDS\n\tEND\n",HEX_0H
     }
+#endif
 };
 
 static int32_t assemblyHeaderIndex = -1;
-- 
2.37.1.windows.1

