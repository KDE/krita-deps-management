seed_windows_qt515_custom:
  stage: Dependencies
  extends:
  - .seed_template
  - .windows_qt515
  variables:
    KRITA_STAGE_DEP:
      value: "ext_unknown"
  script:
    - python -u ci-utilities/seed-multiple-projects.py -p $KRITA_STAGE_DEP --platform Windows/Qt5/Shared --branch master 2>&1 | Tee-Object -FilePath "seed-packages-win64.log"
  artifacts:
    when: always
    expire_in: 1 week
    paths:
      - ".\\**\\meson-logs\\meson-log.txt"
      - ".\\**\\CMakeCache.txt"
      - ".\\**\\CMakeFiles\\CMakeOutput.log"
      - ".\\**\\config.log"
      - "*.log"
    exclude:
      - "./**/meson-private/**/*"

seed_appimage_qt515_custom:
  stage: Dependencies
  extends:
  - .seed_template
  - .appimage_qt515
  variables:
    KRITA_STAGE_DEP:
      value: "ext_unknown"
  script:
    - python3 -u ci-utilities/seed-multiple-projects.py -p $KRITA_STAGE_DEP --platform Linux/Qt5/Shared --branch master 2>&1 | tee "seed-packages-linux.log"
  artifacts:
    when: always
    expire_in: 1 week
    paths:
      - "./**/meson-logs/meson-log.txt"
      - "./**/CMakeCache.txt"
      - "./**/CMakeFiles/CMakeOutput.log"
      - "./**/config.log"
      - "*.log"
    exclude:
      - "./**/meson-private/**/*"

seed_macos_qt515_custom:
  stage: Dependencies
  extends:
  - .seed_template
  - .macos_qt515
  variables:
    KRITA_STAGE_DEP:
      value: "ext_unknown"
  script:
    - python3 -u ci-utilities/seed-multiple-projects.py -p $KRITA_STAGE_DEP --platform MacOS/Qt5/Shared --branch master 2>&1 | tee "seed-packages-macos.log"
  artifacts:
    when: always
    expire_in: 1 week
    paths:
      - "./**/meson-logs/meson-log.txt"
      - "./**/CMakeCache.txt"
      - "./**/CMakeFiles/CMakeOutput.log"
      - "./**/config.log"
      - "*.log"
    exclude:
      - "./**/meson-private/**/*"

seed_macos_qt515_custom_local_cache:
  extends:
  - seed_macos_qt515_custom
  - .local_cache_mixin

.shared_job_template_windows:
  variables:
    KDECI_REMOVE_INSTALL_FOLDERS_AFTER_BUILD: False
    KDECI_SHARED_INSTALL_PATH: $CI_PROJECT_DIR\_shared_install

.shared_job_template_unix:
  variables:
    KDECI_REMOVE_INSTALL_FOLDERS_AFTER_BUILD: False
    KDECI_SHARED_INSTALL_PATH: $CI_PROJECT_DIR/_shared_install

seed_windows_qt515_custom_shared:
  extends:
  - seed_windows_qt515_custom
  - .shared_job_template_windows


seed_appimage_qt515_custom_shared:
  extends:
  - seed_appimage_qt515_custom
  - .shared_job_template_unix

seed_macos_qt515_custom_shared:
  extends:
  - seed_macos_qt515_custom
  - .shared_job_template_unix

seed_windows_qt515_dirty:
  extends:
  - seed_windows_qt515_custom
  script:
  - python -u tools/seed-dirty-projects.py -p $KRITA_STAGE_DEP --platform Windows/Qt5/Shared --branch master 2>&1 | Tee-Object -FilePath "seed-packages-win64.log"

seed_appimage_qt515_dirty:
  extends:
    - seed_appimage_qt515_custom
  script:
    - python3 -u tools/seed-dirty-projects.py -p $KRITA_STAGE_DEP --platform Linux/Qt5/Shared --branch master 2>&1 | tee "seed-packages-linux.log"

seed_macos_qt515_dirty:
  extends:
    - seed_macos_qt515_custom
  script:
    - python3 -u tools/seed-dirty-projects.py -p $KRITA_STAGE_DEP --platform MacOS/Qt5/Shared --branch master 2>&1 | tee "seed-packages-macos.log"

seed_windows_qt515_dirty_shared:
  extends:
    - seed_windows_qt515_dirty
    - .shared_job_template_windows

seed_appimage_qt515_dirty_shared:
  extends:
    - seed_appimage_qt515_dirty
    - .shared_job_template_unix

seed_macos_qt515_dirty_shared:
  extends:
    - seed_macos_qt515_dirty
    - .shared_job_template_unix


.qt_flavour_build_mixin_unix:
  variables:
    KRITACI_QT_PROJECT: ext_qt
    KRITACI_QT_PLATFORM: Linux
    KRITACI_QT_FLAVOUR: undefined
  script:
    - cd $KRITACI_QT_PROJECT
    - python3 -u ../ci-utilities/run-ci-build.py --project $KRITACI_QT_PROJECT-$KRITACI_QT_FLAVOUR --platform $KRITACI_QT_PLATFORM/Qt5/Shared --branch master 2>&1 | tee "seed-packages-linux.log"

.qt_flavour_build_mixin_windows:
  variables:
    KRITACI_QT_PROJECT: ext_qt
    KRITACI_QT_FLAVOUR: undefined
  script:
    - cd $KRITACI_QT_PROJECT
    - python -u ..\ci-utilities\run-ci-build.py --project $KRITACI_QT_PROJECT-$KRITACI_QT_FLAVOUR --platform Windows/Qt5/Shared --branch master 2>&1 | Tee-Object -FilePath "seed-packages-win64.log"

seed_appimage_qt515_qt-debug:
  extends:
    - seed_appimage_qt515_custom
    - .qt_flavour_build_mixin_unix
  variables:
    KRITACI_QT_PLATFORM: Linux
    KRITACI_QT_FLAVOUR: debug
    KDECI_EXTRA_CMAKE_ARGS: '-DQT_ENABLE_DEBUG_INFO=ON'

seed_appimage_qt515_qt-asan:
  extends:
    - seed_appimage_qt515_custom
    - .qt_flavour_build_mixin_unix
  variables:
    KRITACI_QT_PLATFORM: Linux
    KRITACI_QT_FLAVOUR: asan
    KDECI_EXTRA_CMAKE_ARGS: '-DQT_ENABLE_ASAN=ON -DQT_ENABLE_DEBUG_INFO=ON'

seed_appimage_qt515_qt-quickcontrols2:
  extends:
    - seed_appimage_qt515_custom
    - .qt_flavour_build_mixin_unix
  variables:
    KRITACI_QT_PLATFORM: Linux
    KRITACI_QT_FLAVOUR: quickcontrols2
    KDECI_EXTRA_CMAKE_ARGS: '-DQT_ENABLE_QUICKCONTROLS2=ON'

seed_windows_qt515_qt-debug:
  extends:
    - seed_windows_qt515_custom
    - .qt_flavour_build_mixin_windows
  variables:
    KRITACI_QT_FLAVOUR: debug
    KDECI_EXTRA_CMAKE_ARGS: '-DQT_ENABLE_DEBUG_INFO=ON'

seed_windows_qt515_qt-asan:
  extends:
    - seed_windows_qt515_custom
    - .qt_flavour_build_mixin_windows
  variables:
    KRITACI_QT_FLAVOUR: asan
    KDECI_EXTRA_CMAKE_ARGS: '-DQT_ENABLE_ASAN=ON -DQT_ENABLE_DEBUG_INFO=ON'

seed_windows_qt515_qt-quickcontrols2:
  extends:
    - seed_windows_qt515_custom
    - .qt_flavour_build_mixin_windows
  variables:
    KRITACI_QT_FLAVOUR: quickcontrols2
    KDECI_EXTRA_CMAKE_ARGS: '-DQT_ENABLE_QUICKCONTROLS2=ON'

seed_android_x86_64_qt515_qt-quickcontrols2:
  extends:
    - .seed_android_qt515_custom
    - .seed_android_x86_64_qt515
    - .qt_flavour_build_mixin_unix
  variables:
    KRITACI_QT_PLATFORM: Android/x86_64
    KRITACI_QT_FLAVOUR: quickcontrols2
    KDECI_EXTRA_CMAKE_ARGS: '-DQT_ENABLE_QUICKCONTROLS2=ON'

seed_macos_qt515_qt-quickcontrols2:
  extends:
    - seed_macos_qt515_custom
    - .qt_flavour_build_mixin_unix
  variables:
    KRITACI_QT_PLATFORM: MacOS
    KRITACI_QT_FLAVOUR: quickcontrols2
    KDECI_EXTRA_CMAKE_ARGS: '-DQT_ENABLE_QUICKCONTROLS2=ON'

seed_appimage_qt515_mlt-debug:
  extends:
    - seed_appimage_qt515_custom
    - .qt_flavour_build_mixin_unix
  variables:
    KRITACI_QT_PROJECT: ext_mlt
    KRITACI_QT_PLATFORM: Linux
    KRITACI_QT_FLAVOUR: debug
    KDECI_EXTRA_CMAKE_ARGS: '-DMLT_ENABLE_DEBUG_INFO=ON'

seed_windows_qt515_mlt-debug:
  extends:
    - seed_windows_qt515_custom
    - .qt_flavour_build_mixin_windows
  variables:
    KRITACI_QT_PROJECT: ext_mlt
    KRITACI_QT_FLAVOUR: debug
    KDECI_EXTRA_CMAKE_ARGS: '-DMLT_ENABLE_DEBUG_INFO=ON'

seed_android_x86_64_qt515_mlt-debug:
  extends:
    - .seed_android_qt515_custom
    - .seed_android_x86_64_qt515
    - .qt_flavour_build_mixin_unix
  variables:
    KRITACI_QT_PROJECT: ext_mlt
    KRITACI_QT_PLATFORM: Android/x86_64
    KRITACI_QT_FLAVOUR: debug
    KDECI_EXTRA_CMAKE_ARGS: '-DMLT_ENABLE_DEBUG_INFO=ON'

seed_macos_qt515_mlt-debug:
  extends:
    - seed_macos_qt515_custom
    - .qt_flavour_build_mixin_unix
  variables:
    KRITACI_QT_PROJECT: ext_mlt
    KRITACI_QT_PLATFORM: MacOS
    KRITACI_QT_FLAVOUR: debug
    KDECI_EXTRA_CMAKE_ARGS: '-DMLT_ENABLE_DEBUG_INFO=ON'
